<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Valentine Adventure - Level 1</title>
  <style>
    body {
      margin: 0;
      background: #202030;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: #fff;
      font-family: sans-serif;
    }
    #game {
      border: 4px solid #fff;
      image-rendering: pixelated;
      background: #1b2033;
    }
  </style>
</head>
<body>
  <canvas id="game" width="640" height="480"></canvas>

  <script>
    console.log("Game script running");

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const TILE = 32;
    const COLS = canvas.width / TILE;   // 20
    const ROWS = canvas.height / TILE;  // 15

    const TILE_GRASS   = 0;
    const TILE_WATER   = 1;
    const TILE_LILYPAD = 2;
    const TILE_HOUSE   = 3;
    const TILE_LILY    = 4;
    const TILE_TARGET  = 5;

    // Build base map
    const map = [];
    for (let y = 0; y < ROWS; y++) {
      map[y] = [];
      for (let x = 0; x < COLS; x++) {
        // Default grass
        map[y][x] = TILE_GRASS;
      }
    }

    // Pond area
    for (let y = 7; y <= 11; y++) {
      for (let x = 5; x <= 14; x++) {
        map[y][x] = TILE_WATER;
      }
    }

    // Island (lilypad) in middle of pond
    for (let x = 8; x <= 11; x++) {
      map[8][x] = TILE_LILYPAD;
      map[9][x] = TILE_LILYPAD;
      map[10][x] = TILE_LILYPAD;
    }

    // House strip on island
    map[7][9]  = TILE_HOUSE;
    map[7][10] = TILE_HOUSE;

    // Bridge from grass to island (lilypad tiles)
    // vertical bridge at x = 9 from y = 6 down to y = 10
    for (let y = 6; y <= 10; y++) {
      map[y][9] = TILE_LILYPAD;
    }

    // Wild lilies on grass side (left/right)
    const wildLilyPositions = [
      [3, 8], [5, 5], [6, 12],
      [15, 6], [16, 10], [13, 13]
    ];
    for (const [x, y] of wildLilyPositions) {
      map[y][x] = TILE_LILY;
    }

    // Target spots on island around house
    const targetPositions = [
      [8, 9], [9, 9], [10, 9], [11, 9],
      [8, 10], [11, 10]
    ];
    for (const [x, y] of targetPositions) {
      if (map[y][x] === TILE_LILYPAD || map[y][x] === TILE_GRASS) {
        map[y][x] = TILE_TARGET;
      }
    }

    let liliesCollected = 0;
    const totalTargets = targetPositions.length;
    let liliesPlaced = 0;

    // Player starts on grass near the bridge
    const player = {
      x: 7,
      y: 10
    };

    function insideBounds(nx, ny) {
      return nx >= 0 && nx < COLS && ny >= 0 && ny < ROWS;
    }

    function isWalkable(tile) {
      // Can walk on grass and lilypad; not on water or house
      return tile === TILE_GRASS || tile === TILE_LILYPAD || tile === TILE_LILY || tile === TILE_TARGET;
    }

    function interact() {
      const x = player.x;
      const y = player.y;
      const tile = map[y][x];

      if (tile === TILE_LILY) {
        liliesCollected += 1;
        map[y][x] = TILE_GRASS;
      } else if (tile === TILE_TARGET && liliesCollected > 0) {
        liliesCollected -= 1;
        liliesPlaced += 1;
        map[y][x] = TILE_LILY;
      }
    }

    window.addEventListener('keydown', e => {
      if (e.key === ' ' || e.key === 'Enter' || e.key === 'e' || e.key === 'E') {
        interact();
        return;
      }

      let dx = 0, dy = 0;
      if (e.key === 'ArrowLeft' || e.key === 'a')        dx = -1;
      else if (e.key === 'ArrowRight' || e.key === 'd')  dx = 1;
      else if (e.key === 'ArrowUp' || e.key === 'w')     dy = -1;
      else if (e.key === 'ArrowDown' || e.key === 's')   dy = 1;

      if (dx !== 0 || dy !== 0) {
        const nx = player.x + dx;
        const ny = player.y + dy;
        if (insideBounds(nx, ny) && isWalkable(map[ny][nx])) {
          player.x = nx;
          player.y = ny;
        }
      }
    });

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let y = 0; y < ROWS; y++) {
        for (let x = 0; x < COLS; x++) {
          const tile = map[y][x];
          if (tile === TILE_GRASS) {
            ctx.fillStyle = '#2f9e44';
          } else if (tile === TILE_WATER) {
            ctx.fillStyle = '#1864ab';
          } else if (tile === TILE_LILYPAD) {
            ctx.fillStyle = '#38b000';
          } else if (tile === TILE_HOUSE) {
            ctx.fillStyle = '#d4a373';
          } else if (tile === TILE_LILY) {
            ctx.fillStyle = '#ffb3c6';
          } else if (tile === TILE_TARGET) {
            ctx.fillStyle = '#9ef01a';
          }
          ctx.fillRect(x * TILE, y * TILE, TILE, TILE);
        }
      }

      // Player
      ctx.fillStyle = '#ffd35a';
      ctx.fillRect(player.x * TILE, player.y * TILE, TILE, TILE);

      // HUD
      ctx.fillStyle = '#000000aa';
      ctx.fillRect(0, 0, canvas.width, 40);

      ctx.fillStyle = '#ffffff';
      ctx.font = '14px sans-serif';
      ctx.fillText('Move with WASD / arrows. Press E / Space / Enter to pick/place lilies.', 10, 18);
      ctx.fillText(`Lilies in bag: ${liliesCollected} | Spots filled: ${liliesPlaced}/${totalTargets}`, 10, 34);
    }

    function loop() {
      draw();
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  </script>
</body>
</html>
